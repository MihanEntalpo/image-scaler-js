# Workflow / Lessons Learned

## Общие правила
- Перед началом работы перечитывайте `tasks.md` и этот файл, чтобы не пропустить новые требования или набитые шишки.
- Любые новые открытия, проблемы и способы их решения фиксируйте ниже отдельными пунктами.

## История и выводы
1. **Документация задач.** Храните исходные требования и уточнения в `tasks.md`, иначе легко потерять контекст — изменения в коде должны явно ссылаться на задачи из файла.
2. **Работа с линейкой.** У линейки должна быть постоянная толщина, поэтому лучше управлять стилем через CSS-переменную и считывать её в JS при вычислениях, а не дублировать значения.
3. **Растягивание линейки.** Чтобы растяжение происходило только со стороны захваченной ручки, отслеживайте активную сторону и корректируйте длину относительно фиксированной опорной точки. Симметричное масштабирование выглядит странно для пользователя.
4. **Перекрывающиеся кнопки.** Кнопки поворота и растяжения лучше располагать на противоположных концах линейки и позиционировать через flex, иначе элементы наезжают друг на друга при смене ориентации.
5. **Бесполезные попытки.** Пытаться вычислять толщину линейки по `offsetHeight` до того, как она вставлена в DOM, бессмысленно — значение будет равно нулю. Всегда дожидайтесь рендеринга или используйте известные константы/переменные.
6. **Горячие клавиши для трансформаций.** Если нужно масштабирование "из центра", проще добавить отдельный режим (например, Shift+drag) и хранить состояние точки-якоря (центр кадра), чем пытаться переработать существующие хендлы.
7. **Одностороннее растягивание линейки.** Чтобы ручка вытягивала линейку в заданную сторону, храните точку фиксированного края и ограничивайте максимальную длину доступным пространством, иначе автоматический `clamp` сместит линейку целиком.
8. **Экспорт в исходном формате.** Canvas умеет сохранять не все типы изображений, поэтому перед передачей MIME-типов в `toBlob` нужно проверять поддержку (через `toDataURL`) и при необходимости откатываться на PNG.
9. **Риски линейки.** Фоновые градиенты плохо подходят для разных толщин и ориентаций, поэтому риски лучше отрисовывать на отдельном canvas — так легче управлять длиной и прозрачностью линий.
